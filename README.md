![fixed2lambdas drawio (2)](https://github.com/eranmekler/commit_project/assets/132250761/5dcea96d-edc7-4a15-8ff9-3385b3dfc9bd)

# Serverless Authentication Solution with AWS

This repository contains a serverless solution using various AWS services to authenticate users and log their activities. This README provides a detailed explanation of each component used in the solution.

## Architecture Overview

The solution comprises of the following components:

1. **Cognito**: Authenticates users.
2. **CloudWatch**: Captures and logs login activities.
3. **API Gateway**: Transports authentication codes to the Lambda function.
4. **Authentication Lambda**: Exchanges authentication codes for tokens.
5. **Cognito API Gateway Authorizer**: Securely moves tokens in header to lambda, using cognito authorizer.
6. **Lambda**: Accepts and verifies tokens after successful authentication.
7. **DynamoDB**: Stores user details username and timestamp.
8. **S3**: Writes files containing usernames and timestamp details.
9. **Parameter Store**: Stores parameters to greet the user.

## Detailed Components Explanation

### 1. Cognito

**Purpose**: Cognito serves as the primary user directory, allowing users to sign up and sign in. 

**Implementation**: Once a user signs in or signs up, Cognito generates an authentication code to confirm the user's identity.

### 2. CloudWatch

**Purpose**: To keep a log of each user's login activities for monitoring or auditing purposes.

**Implementation**: Each time a user logs in, an entry with the user's details and timestamp is written to CloudWatch logs.

### 3. API Gateway

**Purpose**: transport of the authentication code to the Authentication Lambda.

**Implementation**: When the user logs in, the auth code generated by Cognito is sent via API Gateway to the Authentication Lambda.

### 4. Authentication Lambda

**Purpose**: Exchanges the auth code for a user token.

**Implementation**: The lambda function contacts the token endpoint using the received auth code and retrieves the corresponding user token.

### 5. Cognito API Gateway Authorizer

**Purpose**: Securely transports the token in the headers to backend.

**Implementation**: Before any request is processed by the backend, the Cognito API Gateway Authorizer verifies the token provided in the request header. It ensures the token is valid and hasn't been tampered with.

### 6. Lambda

**Purpose**: Verifies and accepts the token after successful authentication.

**Implementation**: Once the token is authenticated by the Cognito API Gateway Authorizer, this lambda function processes the user's request. 

### 7. DynamoDB

**Purpose**: To store user details.

**Implementation**: After successful token verification, the lambda function writes the user's username and the current timestamp to a DynamoDB table.

### 8. S3

**Purpose**: Store user-related files.

**Implementation**: A file with the user's name as the filename is created. The content of this file is the current date and time. This file is then stored in an S3 bucket.

### 9. Parameter Store

**Purpose**: Store parameters to greet the user.

**Implementation**: Parameters like greeting messages or any other user-specific configuration can be stored in the Parameter Store. These parameters can then be fetched and used to personalize the user's welcoming message.

## Getting Started

- Clone the repository.
- Set up AWS CLI and configure with appropriate permissions.
- Set your account id, region and cognito domain name. Change required fields in locals.tf file.
- Deploy the infrastructure using the provided scripts.
- Navigate to the Cognito user pool to sign up or sign in.

